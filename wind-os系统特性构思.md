# wind-os工作规划

###  1、已经完成
- [x] 自己编写一个单元测试的工具，用于系统测试。
- [x] 将所有的变量集中管理，便于以后构建内核与用户态分离。
- [x] 将软件定时器按不同的精度充定义，高精度的在tick中断直接处理，低精度则转移到一个专门的定时器线程来处理。
- [x] 互斥锁不要在系统中管理，而是附加到其他的变量中，便于在多重场景下使用局部锁而不是全局锁。
- [x] 内存管理的函数一定要封装，以便以后可能会改动
- [x] 非频繁的状态变迁一定要打印日志 
- [x] 将统计功能的数据内置到pool模块中，这样就可以完全直接统计，而不受统计模块本省的限制。
- [x] 建立一个树形节点的结构，允许在任何地方方便地建立一棵树。 
- [x] 将各种内核对象的对象池建立在各自的模块内，这样方便裁剪。
- [x] 用命令行实现测试的查看和执行功能。
- [x] 删除消息的内存池，消息应该对应到相应的消息结构中。
- [x] 内存池自动对齐。
- [x] 私有堆机制的支持,创建时指定一个堆是否为私有堆，私有堆不允许通过通用分配方法调用，只能指定堆分配。
- [x] 互斥锁的拥有者才能解锁，重复锁定无效。
- [x] 邮箱是私有的，只能被创建者使用，其它线程可以发邮件，不能取邮件。
- [x] 移植lua脚本解组件。
- [x] 支持线程级看门狗功能。
- [x] 兼容同一线程嵌套上锁的问题，允许多次加锁，同时输出警告。
- [x] 增加可以对线程进行操作的命令。
- [x] 新增移植时记录软硬件版本号，架构，CPU型号，板卡号等信息和相应的命令；
- [x] 支持事件触发机制。
- [x] 支持不通过内存池来创建内核对象；
- [x] 支持创建匿名对象，匿名对象不能查询获取。
###  2、正在规划
- [ ] 改造内核模块。逐步取消全局的list。
- [ ] 搞在历史命令列表，取消重复历史命令。
- [ ] 整合当前已经具备基本雏形的工程，尽可能的复用现有代码。
- [ ] 实现bootloader和在线升级功能。
- [ ] 新增字符串大小写转换函数。
- [ ] 动态新增内存池。
- [ ] 近期提供一个可用的稳定版本。
- [ ] 完善文件系统功能。

- [ ] 完成LwIP协议栈的移植。
- [ ] 移植modbus，canopen，onenet等开源组件。
- [ ] 提供踩内存诊断，栈溢出诊断，内存泄漏诊断。
- [ ] 处理硬件异常中断后的栈信息，提供诊断依据。
- [ ] 调试变量支持，新增状态处理的变量在系统中注册，方便在调试时查看。
- [ ] 环境变量支持
- [ ] 制定一套可在物联网上运行的协议。
- [ ] 需要定义清楚文件适配层的函数功能。
- [ ] DB组件功能的支持。
- [ ] 日志组件功能的支持。
- [ ] 网络协议栈组建支持。
- [ ] GUI组件支持。
- [ ] 在栈底加入标记字段用于堆栈溢出检测。
- [ ] 切换高优先级线程后，怎样保证在这个过程中线程不会发生中断切换，这样可能会导致两次切换到同一线程，而第二次很可能线程已经不需要执行。这样就可能存在时序混乱的风险。
- [ ] 资源回收机制，定义一个资源的使用时间期限，在超过期限的时间内，如果资源没有被使用，将实现自动回收。前期只保证系统资源的自动回收。
- [ ] 记录对象的存活时间，用于诊断内存泄漏。
- [ ] 整合统一的下载和升级流程，按照状态机的不同状态切入流程的不同阶段。
- [ ] 补齐所有系统层面的错误（异常）打印。
- [ ] 逐步统一形成一致的硬件接口调用方法，方便整体移植。
- [ ] 将中断转换成事件，将中断的下半步转移到内核任务级处理，增强中断并发和嵌套。
- [ ] 定义系统资源可以动态配置，可以保存在系统参数中，在初始化时分配。
- [ ] 将一些常用的功能封装成服务，便于外部的统一调用。
- [ ] 定义一个线程专门处理硬件错误中断，这样需要保存每次线程切换时的上一个线程。这种机制主要是解决在异常时的诊断方法，对于某些不可接收的错误也可触发。
- [ ] 在守护线程实现对线程整体的执行状态监控，防止一个高优先级线程阻塞低优先级线程的执行。

- [ ] 内核态的线程不受外部控制。

#### 怎样解决进入同步API后的数据一致性问题？
#### 目前最大的隐患是多线程在删除链表对象与便利链表对象时的一致性问题？


